# Skills 测试策略

> 系统化的测试方式，用于验证 Godot Skills 的功能和协作能力

---

## 测试分类

### 1. 单元测试（Single Skill Testing）

测试单个 skill 的独立功能，确保每个 skill 都能正确完成其核心职责。

#### 1.1 godot-role-builder 单元测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 基础玩家创建 | "创建一个玩家角色" | 使用默认模板创建玩家 | 所有必需behaviors配置正确 |
| 自定义血量 | "创建一个血量200的玩家" | 玩家血量=200 | health behavior正确配置 |
| 自定义速度 | "创建一个速度100的敌人" | 敌人速度=100 | speed behavior正确配置 |
| 自定义动画 | "创建一个使用火焰动画的法师" | 使用指定SpriteFrames | animated_sprite2d配置正确 |
| 多角色创建 | "创建3个不同的敌人" | 3个独立角色文件 | 命名不冲突，路径正确 |
| 行为树关联 | "创建一个带巡逻AI的敌人" | 行为树正确关联 | behavior_tree behavior配置 |

**验证方法**：
- 检查场景文件是否存在
- 验证behaviors配置（`GetBehaviorsFromScene`）
- 检查节点结构（`GetSceneTree`）

#### 1.2 godot-scene-builder 单元测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 基础场景创建 | "创建一个游戏场景" | 场景文件创建成功 | 使用正确模板 |
| 实体实例化 | "在场景中添加玩家和敌人" | 实体正确添加到场景 | 节点名正确，位置合理 |
| 多实体组装 | "创建一个包含5个敌人的场景" | 5个敌人实例化 | 命名不冲突 |
| UI层添加 | "添加一个显示血量的UI" | CanvasLayer和Label添加 | UI结构正确 |
| 属性覆盖 | "设置玩家位置为(100, 200)" | 位置属性正确设置 | SetProperty生效 |

**验证方法**：
- 检查场景树结构
- 验证节点位置和属性
- 确认实体引用正确

#### 1.3 godot-event-builder 单元测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 简单事件 | "场景开始时设置变量x=10" | on_ready事件添加 | 事件表结构正确 |
| 条件判断 | "当血量<50时显示警告" | 条件+动作组合 | 条件逻辑正确 |
| 信号发射 | "碰撞时发射'开门'信号" | 信号事件配置 | 信号名正确 |
| 多动作序列 | "敌人死亡时：播放音效+生成道具+更新分数" | 多个动作执行 | 动作顺序正确 |
| 变量操作 | "关卡+1并更新UI显示" | 变量更新+UI更新 | 变量引用正确 |

**验证方法**：
- 检查FlowKit事件表（`GetFlowKitSheetStatus`）
- 验证事件-条件-动作结构
- 确认节点引用正确

#### 1.4 godot-behavior-tree-builder 单元测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 简单行为树 | "创建一个巡逻行为树" | 行为树文件创建 | 节点结构正确 |
| 复合行为 | "创建：待机→巡逻→攻击的行为树" | 序列节点配置 | 行为顺序正确 |
| 条件分支 | "血量<50%时逃跑，否则攻击" | 选择器节点 | 条件判断正确 |
| 行为树关联 | "为敌人关联巡逻行为树" | behavior_tree配置 | 路径引用正确 |

**验证方法**：
- 检查行为树场景文件
- 验证Beehave节点结构
- 确认行为逻辑正确

---

### 2. 集成测试（Multi-Skill Integration）

测试多个 skills 的协作能力，验证 skill 之间的数据传递和调用顺序。

#### 2.1 角色+场景集成

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 自定义角色场景化 | "创建一个血量150的玩家，然后把他放到场景中" | 角色创建→场景实例化 | 调用顺序正确，路径引用正确 |
| 多角色场景组装 | "创建3种不同敌人，然后放到一个场景中" | 3个角色→1个场景 | 所有角色正确实例化 |
| 角色+行为树+场景 | "创建一个带巡逻AI的敌人，放到场景中" | 角色+行为树→场景 | 行为树正确关联 |

**验证方法**：
- 检查调用链完整性
- 验证路径引用一致性
- 确认最终场景结构

#### 2.2 场景+事件集成

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 场景+基础逻辑 | "创建一个场景，添加玩家和敌人，敌人死亡时播放音效" | 场景创建→事件添加 | 节点名引用正确 |
| 场景+复杂逻辑 | "场景中有门，消灭所有敌人后门打开" | 场景+门+事件逻辑 | 事件条件正确 |
| UI+事件联动 | "场景中添加血量UI，玩家受伤时更新显示" | UI添加+事件绑定 | UI节点路径正确 |

**验证方法**：
- 检查事件表中的节点引用
- 验证事件逻辑完整性
- 确认UI更新机制

#### 2.3 完整游戏流程集成

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 简单游戏demo | "做一个游戏demo，有地图、玩家、敌人，消灭敌人后过关" | 完整游戏场景 | 所有组件正确协作 |
| 多关卡游戏 | "做一个游戏，有3个关卡，每关敌人数量递增" | 多场景+关卡逻辑 | 场景切换正确 |
| 复杂游戏机制 | "做一个收集道具的游戏，收集5个道具后Boss出现" | 道具+计数+Boss生成 | 逻辑链条完整 |

**验证方法**：
- 端到端功能验证
- 检查所有skill调用
- 验证游戏流程完整性

---

### 3. 边界情况测试（Edge Cases）

测试极端情况和边界条件，确保系统在异常情况下也能正常工作。

#### 3.1 空值/缺失参数测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 无参数角色创建 | "创建一个角色" | 使用所有默认值 | 默认值正确应用 |
| 部分参数缺失 | "创建一个玩家"（未指定血量） | 使用默认血量 | 默认值填充正确 |
| 空场景 | "创建一个空场景" | 只有基础模板 | 场景结构正确 |

#### 3.2 极端数值测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 超大血量 | "创建一个血量99999的玩家" | 血量正确设置 | 数值范围处理 |
| 零速度 | "创建一个速度0的敌人" | 速度=0（静止） | 零值处理 |
| 负数参数 | "创建一个血量-100的角色" | 错误处理或默认值 | 参数验证 |

#### 3.3 大量实体测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 大量敌人 | "创建一个场景，包含100个敌人" | 性能可接受 | 批量操作效率 |
| 多关卡递增 | "创建10个关卡，每关增加10个敌人" | 场景正确创建 | 递增逻辑正确 |
| 复杂事件表 | "场景中有50个事件" | 事件表正确 | 事件表大小限制 |

#### 3.4 命名冲突测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 重复角色名 | "创建两个名为'Player'的角色" | 自动添加序号 | 命名冲突处理 |
| 重复场景名 | "创建两个名为'Level1'的场景" | 自动重命名 | 文件名冲突处理 |
| 节点名冲突 | "场景中添加两个同名节点" | 自动添加序号 | 节点名冲突处理 |

---

### 4. 复杂场景测试（Complex Scenarios）

测试复杂的游戏机制和逻辑组合，验证系统处理复杂需求的能力。

#### 4.1 多系统协作

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 战斗+收集+UI | "做一个游戏：玩家打怪收集金币，金币达到100时显示胜利UI" | 战斗+收集+UI联动 | 多系统协作 |
| AI+事件+场景 | "创建一个Boss，血量<50%时召唤小怪，小怪全灭后Boss狂暴" | AI+事件+动态生成 | 复杂逻辑链 |
| 技能+行为树+事件 | "玩家使用技能时，敌人根据血量选择逃跑或反击" | 技能触发+AI决策 | 跨系统交互 |

#### 4.2 状态管理

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 多变量状态 | "游戏有血量、魔法值、经验值三个状态，分别显示在UI上" | 多变量管理 | 变量系统 |
| 状态同步 | "玩家血量变化时，UI血条和数字同时更新" | 多UI同步更新 | 状态同步机制 |
| 状态持久化 | "关卡切换时保存玩家状态" | 状态保存和恢复 | 持久化机制 |

#### 4.3 动态生成

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 波次生成 | "每30秒生成一波敌人，共5波" | 定时生成+计数 | 动态实例化 |
| 随机生成 | "在随机位置生成10个道具" | 随机位置生成 | 随机算法 |
| 条件生成 | "玩家到达某区域时生成Boss" | 条件触发生成 | 条件判断 |

---

### 5. 错误处理测试（Error Handling）

测试系统在错误情况下的处理能力，确保错误信息清晰且系统不会崩溃。

#### 5.1 无效输入测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 无效路径 | "使用不存在的场景路径" | 错误提示 | 路径验证 |
| 无效节点名 | "引用不存在的节点" | 错误提示 | 节点验证 |
| 无效行为ID | "添加不存在的behavior" | 错误提示 | Behavior验证 |
| 无效事件类型 | "使用不存在的事件类型" | 错误提示 | 事件类型验证 |

#### 5.2 依赖缺失测试

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 缺少必需behavior | "创建玩家但缺少health behavior" | 警告或自动添加 | 依赖检查 |
| 缺少资源文件 | "使用不存在的SpriteFrames" | 错误提示 | 资源验证 |
| 缺少行为树 | "角色配置了behavior_tree但文件不存在" | 错误提示 | 文件验证 |

#### 5.3 冲突检测

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 行为冲突 | "同时添加两个冲突的behavior" | 警告或自动解决 | 冲突检测 |
| 事件冲突 | "同一事件有多个冲突的动作" | 警告或优先级处理 | 事件冲突处理 |
| 节点引用冲突 | "事件引用已删除的节点" | 错误提示 | 引用验证 |

---

### 6. 性能测试（Performance Testing）

测试系统在处理大量实体和复杂逻辑时的性能表现。

#### 6.1 场景加载性能

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 简单场景加载 | "创建一个基础场景" | 加载时间<0.5s | 加载速度 |
| 复杂场景加载 | "创建包含50个实体的场景" | 加载时间<2s | 批量加载效率 |
| 多场景切换 | "快速切换10个场景" | 切换流畅 | 场景切换性能 |

#### 6.2 运行时性能

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 大量实体运行 | "场景中有100个敌人同时运行" | FPS>30 | 实体性能 |
| 复杂事件表 | "场景中有100个事件" | 事件处理不卡顿 | 事件处理效率 |
| 频繁实例化 | "每秒生成10个敌人，持续1分钟" | 内存不泄漏 | 内存管理 |

#### 6.3 批量操作性能

**测试用例**：

| 测试项 | Prompt | 预期结果 | 验证点 |
|--------|--------|----------|--------|
| 批量创建角色 | "一次性创建50个角色" | 使用批量执行 | 批量操作优化 |
| 批量添加事件 | "一次性添加50个事件" | 批量操作 | 网络请求优化 |
| 批量实例化 | "场景中一次性添加50个实体" | 批量执行 | 操作效率 |

---

### 7. 回归测试（Regression Testing）

使用固定的测试用例集，确保新功能不会破坏已有功能。

#### 7.1 核心功能回归

**测试用例集**：

1. **基础角色创建**
   - Prompt: "创建一个玩家角色"
   - 验证：所有必需behaviors配置正确

2. **基础场景创建**
   - Prompt: "创建一个游戏场景，添加玩家和敌人"
   - 验证：场景结构正确，实体正确实例化

3. **基础事件添加**
   - Prompt: "场景开始时设置变量x=10"
   - 验证：事件表正确创建

4. **完整游戏demo**（当前测试用例）
   - Prompt: "做一个游戏demo，有一个地图，然后有野怪，野怪消灭完成后上方的门打开，然后进入下一关，每关增加一个野怪，左上角显示当前关卡"
   - 验证：完整功能正常

#### 7.2 技能协作回归

**测试用例集**：

1. **角色→场景**
   - Prompt: "创建一个血量150的玩家，然后把他放到场景中"
   - 验证：调用链正确

2. **场景→事件**
   - Prompt: "创建一个场景，添加玩家和敌人，敌人死亡时播放音效"
   - 验证：事件引用正确

3. **角色→行为树→场景**
   - Prompt: "创建一个带巡逻AI的敌人，放到场景中"
   - 验证：行为树正确关联

---

## 测试执行建议

### 测试优先级

1. **P0 - 核心功能**：基础角色、场景、事件创建
2. **P1 - 集成功能**：多skill协作、完整游戏demo
3. **P2 - 边界情况**：极端数值、大量实体
4. **P3 - 复杂场景**：多系统协作、动态生成
5. **P4 - 性能测试**：大量实体、复杂逻辑

### 测试频率

- **每次代码变更**：运行P0回归测试
- **功能开发完成**：运行P0+P1测试
- **版本发布前**：运行全部测试用例
- **性能优化后**：运行P4性能测试

### 测试记录

建议记录以下信息：
- 测试用例Prompt
- 执行结果（成功/失败）
- 验证点检查结果
- 发现的问题
- 性能指标（如适用）

---

## 测试用例模板

### 单元测试模板

```
## 测试用例：[测试项名称]

**Prompt**: "[用户输入的prompt]"

**预期结果**: 
- [结果1]
- [结果2]

**验证点**:
- [ ] 验证点1
- [ ] 验证点2

**实际结果**: 
[执行后的实际结果]

**问题记录**:
[如有问题，记录在这里]
```

### 集成测试模板

```
## 测试用例：[测试项名称]

**Prompt**: "[用户输入的prompt]"

**Skill调用链**:
1. [Skill1] → [输出]
2. [Skill2] → [输出]
3. [Skill3] → [输出]

**预期结果**: 
[最终预期结果]

**验证点**:
- [ ] 调用顺序正确
- [ ] 数据传递正确
- [ ] 最终结果正确

**实际结果**: 
[执行后的实际结果]

**问题记录**:
[如有问题，记录在这里]
```

---

## 持续改进

### 测试用例维护

- 定期审查测试用例的有效性
- 根据新功能添加测试用例
- 移除过时的测试用例
- 优化测试用例的覆盖范围

### 测试自动化

未来可以考虑：
- 自动化测试脚本
- 测试结果自动记录
- 性能指标自动收集
- 回归测试自动化

---

## 参考资源

- [Scene Quality Guidelines](../scene/quality-guidelines.md)
- [Entity Quality Guidelines](../entity/quality-guidelines.md)
- [FlowKit Thinking Guide](../guides/flowkit-thinking-guide.md)
- [Skill Orchestration Guide](../guides/skill-orchestration-guide.md)
