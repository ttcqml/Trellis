# Code Reuse Thinking Guide

> **Purpose**: Stop and think before creating new code - does it already exist?

---

## The Problem

**Duplicated code is the #1 source of inconsistency bugs.**

When you copy-paste or rewrite existing logic:
- Bug fixes don't propagate
- Behavior diverges over time
- Codebase becomes harder to understand

---

## Before Writing New Code

### Step 1: Search First

```bash
# Search for similar function names
grep -r "function_name" .

# Search for similar scenes
grep -r "pattern" *.tscn

# Search for behavior usage
grep -r "flowkit_behaviors" .
```

### Step 2: Ask These Questions

| Question | If Yes... |
|----------|-----------|
| Does a similar entity exist? | Use or extend it |
| Is this behavior pattern used elsewhere? | Follow the existing pattern |
| Could this be a shared component? | Create it in the right place |
| Am I copying code from another file? | **STOP** - extract to shared |

---

## Common Duplication Patterns

### Pattern 1: Copy-Paste Entities

**Bad**: Copying an entity scene to create a variant

**Good**: Extend existing entity with different behaviors

### Pattern 2: Similar FlowKit Events

**Bad**: Creating duplicate event blocks in multiple entities

**Good**: Use System events or shared event patterns

### Pattern 3: Repeated Constants

**Bad**: Defining MAX_HEALTH in multiple entity scripts

**Good**: Single source of truth in constants file

### Pattern 4: Similar Behavior Trees

**Bad**: Creating near-identical AI trees for each enemy

**Good**: Use parameterized trees with blackboard configuration

---

## When to Abstract

**Abstract when**:
- Same pattern appears 3+ times
- Logic is complex enough to have bugs
- Multiple entities might need this

**Don't abstract when**:
- Only used once
- Trivial one-liner
- Abstraction would be more complex than duplication

---

## After Batch Modifications

When you've made similar changes to multiple files:

1. **Review**: Did you catch all instances?
2. **Search**: Run grep to find any missed
3. **Consider**: Should this be a shared behavior?

---

## Checklist Before Commit

- [ ] Searched for existing similar code
- [ ] No copy-pasted logic that should be shared
- [ ] Constants defined in one place
- [ ] Similar patterns follow same structure
- [ ] Entity variations use composition, not duplication
